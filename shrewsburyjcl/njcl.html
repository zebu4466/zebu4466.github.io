<!-- ✅ Responsive Image Map Container -->
<div style="max-width: 100%; position: relative;">
  <img 
    src="./north-america.png" 
    usemap="#image-map" 
    style="width: 100%; height: auto; display: block; overflow: hidden;"
    alt="US + Canada Map">
<div id="rotateOverlay" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: white;
  color: black;
  display: none;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: 1.5rem;
  font-family: system-ui, sans-serif;
  z-index: 9999;
  padding: 20px;
  box-sizing: border-box;
">
  Please rotate your device to <strong>landscape mode</strong>.
</div>
  <map name="image-map">
<area target="_blank" alt="Alabama" title="Alabama" href="https://sites.google.com/view/alabama-jcl" coords="2522,2897,20" shape="circle">
    <area target="_blank" alt="Arizona" title="Arizona" href="https://sites.google.com/view/azjcl/home" coords="1511,2824,20" shape="circle">
    <area target="_blank" alt="British Columbia" title="British Columbia" href="https://www.cascadiajcl.org/" coords="1304,1832,20" shape="circle">
    <area target="_blank" alt="California" title="California" href="https://www.cajcl.org/" coords="1202,2624,20" shape="circle">
    <area target="_blank" alt="Colorado" title="Colorado" href="https://coloradojcl.com/" coords="1765,2566,20" shape="circle">
    <area target="_blank" alt="Florida" title="Florida" href="https://fjcl.org" coords="2764,3107,20" shape="circle">
    <area target="_blank" alt="Georgia" title="Georgia" href="https://www.gjcl.org/" coords="2675,2904,20" shape="circle">
    <area target="_blank" alt="Hawaii" title="Hawaii" href="https://hijcl.wordpress.com/" coords="922,2802,20" shape="circle">
    <area target="_blank" alt="Illinois" title="Illinois" href="https://www.iljcl.org/" coords="2385,2503,20" shape="circle">
    <area target="_blank" alt="Indiana" title="Indiana" href="https://ijcl.org/" coords="2503,2487,20" shape="circle">
    <area target="_blank" alt="Kentucky" title="Kentucky" href="http://www.kyjcl.org/" coords="2592,2605,20" shape="circle">
    <area target="_blank" alt="Louisiana" title="Louisiana" href="https://www.louisianajcl.com/" coords="2293,3043,20" shape="circle">
    <area target="_blank" alt="Maine" title="Maine" href="https://www.mejcl.org/" coords="3056,2073,20" shape="circle">
    <area target="_blank" alt="Maryland" title="Maryland" href="http://mdjcl.org/" coords="2859,2468,20" shape="circle">
    <area target="_blank" alt="Massachusetts" title="Massachusetts" href="https://www.massjcl.org/" coords="3021,2261,20" shape="circle">
    <area target="_blank" alt="Michigan" title="Michigan" href="http://www.michiganjcl.org/" coords="2538,2315,20" shape="circle">
<area target="_blank" alt="Minnesota" title="Minnesota" href="https://minnesotajcl.weebly.com" coords="2175,2100,20" shape="circle">
    <area target="_blank" alt="Nebraska" title="Nebraska" href="https://nebraskajcl.weebly.com/" coords="2004,2439,20" shape="circle">
    <area target="_blank" alt="Nevada" title="Nevada" href="https://www.nvjcl.org/" coords="1339,2490,20" shape="circle">
    <area target="_blank" alt="New Jersey" title="New Jersey" href="http://njjcl.weebly.com/" coords="2926,2366,20" shape="circle">
    <area target="_blank" alt="North Carolina" title="North Carolina" href="https://www.northcarolinajcl.org/" coords="2843,2694,20" shape="circle">
    <area target="_blank" alt="Ohio" title="Ohio" href="https://ojcl.org/" coords="2630,2461,20" shape="circle">
    <area target="_blank" alt="Oklahoma" title="Oklahoma" href="http://www.okjcl.org/" coords="2096,2780,20" shape="circle">
    <area target="_blank" alt="Pennsylvania" title="Pennsylvania" href="https://sites.google.com/view/pajcl/home" coords="2811,2395,20" shape="circle">
    <area target="_blank" alt="Tennessee" title="Tennessee" href="https://www.tjcl.org/" coords="2525,2722,20" shape="circle">
    <area target="_blank" alt="Texas" title="Texas" href="https://www.tsjcl.org/" coords="2016,3008,20" shape="circle">
    <area target="_blank" alt="Virginia" title="Virginia" href="https://virginiajcl.org/index.html" coords="2814,2579,20" shape="circle">
    <area target="_blank" alt="Wisconsin" title="Wisconsin" href="http://www.wjcl.org/" coords="2344,2239,20" shape="circle">
    <area target="_blank" alt="Washington" title="Washington" href="https://www.cascadiajcl.org/" coords="1294,2032,20" shape="circle">
    <area target="_blank" alt="Oregon" title="Oregon" href="https://www.cascadiajcl.org/" coords="1234,2239,20" shape="circle">
    <area target="_blank" alt="Arkansas (TBD)" title="Arkansas (TBD)" href="mailto:mstover@mtstmary.edu" coords="2277,2805,20" shape="circle">
    <area target="_blank" alt="Connecticut" title="Connecticut" href="https://ctjcl.weebly.com" coords="2986,2306,20" shape="circle">
    <area target="_blank" alt="Delaware (TBD)" title="Delaware (TBD)" href="mailto:wolanskid@sanfordschool.org" coords="2919,2490,20" shape="circle">
    <area target="_blank" alt="District of Columbia (TBD)" title="District of Columbia (TBD)" href="mailto:mobea68@gmail.com" coords="2859,2496,20" shape="circle">
    <area target="_blank" alt="Kansas (TBD)" title="Kansas (TBD)" href="mailto:JZDillon@bluevalleyk12.org" coords="2042,2614,20" shape="circle">
    <area target="_blank" alt="Mississippi (TBD)" title="Mississippi (TBD)" href="https://msjcl.mystrikingly.com/" coords="2407,2919,20" shape="circle">
    <area target="_blank" alt="Missouri" title="Arkansas (TBD)" href="https://sites.google.com/view/mojcl/njcl" coords="2277,2605,20" shape="circle">
    <area target="_blank" alt="New Hampshire" title="New Hampshire" href="https://nhjcl.weebly.com" coords="2999,2207,20" shape="circle">
    <area target="_blank" alt="New York" title="New York" href="https://sites.google.com/view/nyjcl" coords="2884,2258,20" shape="circle">
    <area target="_blank" alt="North Dakota" title="North Dakota" href="https://northdakotajcl.wixsite.com/ndjcl" coords="1962,2096,20" shape="circle">
    <area target="_blank" alt="Rhode Island (TBD)" title="Rhode Island (TBD)" href="mailto:ebenestad@portsmouthabbey.org" coords="3024,2302,20" shape="circle">
    <area target="_blank" alt="South Carolina" title="South Carolina" href="https://www.southcarolinajcl.org" coords="2773,2811,20" shape="circle">
    <area target="_blank" alt="Utah (TBD)" title="Utah (TBD)" href="mailto:tsoran@judgememorial.com" coords="1533,2557,20" shape="circle">
    <area target="_blank" alt="Vermont (TBD)" title="Vermont (TBD)" href="mailto:rstarling201@gmail.com" coords="2951,2153,20" shape="circle">
    <area target="_blank" alt="West Virginia (TBD)" title="West Virginia (TBD)" href="mailto:amy.mcelroy1@gmail.com" coords="2710,2551,20" shape="circle">
  </map>
</div>

<script>
  const AREA_RADIUS = 8.25;
  const ICON_SCALE = 2.5;

  function resizeImageMap() {
    const images = document.querySelectorAll('img[usemap]');
    images.forEach(img => {
      if (!img.naturalWidth || !img.naturalHeight) return;

      const w = img.naturalWidth;
      const h = img.naturalHeight;
      const mapName = img.getAttribute('usemap').replace('#', '');
      const areas = document.querySelectorAll(`map[name="${mapName}"] area`);

      areas.forEach(area => {
        const original = area.dataset.coords;
        if (!original) return;

        const coordsArr = original.split(',').map(Number);
        if (coordsArr.length === 3) coordsArr[2] = AREA_RADIUS;

        const scaledCoords = [
          coordsArr[0] / w * img.width,
          coordsArr[1] / h * img.height,
          coordsArr[2] / w * img.width
        ];

        area.setAttribute('coords', scaledCoords.join(','));
      });

      repositionMarkers(img);
    });
  }

  function repositionMarkers(img) {
    const parent = img.parentElement;
    const areas = document.querySelectorAll(`map[name="${img.getAttribute('usemap').replace('#','')}"] area`);
    const markers = parent.querySelectorAll('.jcl-marker');

    markers.forEach(m => m.remove());

    areas.forEach(area => {
      const coords = area.dataset.coords;
      if (!coords) return;

      const [x, y] = coords.split(',').map(Number);
      if (Number.isNaN(x) || Number.isNaN(y)) return;

      const marker = document.createElement('a');
      marker.href = area.href;
      marker.target = area.target || '_blank';
      marker.className = 'jcl-marker';
      marker.style.position = 'absolute';
      marker.style.left = `${(x / img.naturalWidth) * 100}%`;
      marker.style.top = `${(y / img.naturalHeight) * 100}%`;
      marker.style.transform = 'translate(-50%, -50%)';
      marker.style.display = 'block';
      marker.style.zIndex = 10;

      const icon = document.createElement('img');
      icon.src = 'https://www.njcl.org/Portals/1/JCL_wreath.png';
      icon.style.width = `${AREA_RADIUS * ICON_SCALE}px`;
      icon.style.height = 'auto';
      icon.style.pointerEvents = 'none';

      // ✅ Make all valid links visible, including http:// and mailto:
      if (area.href.startsWith('http://') || area.href.startsWith('https://')) {
        icon.style.opacity = '1';
      } else if (area.href.startsWith('mailto:')) {
        icon.style.opacity = '0.5';
      } else {
        icon.style.opacity = '0';
        marker.style.pointerEvents = 'none';
      }

      marker.appendChild(icon);
      parent.appendChild(marker);
    });
  }

  function updateOverlay() {
    const overlay = document.getElementById('rotateOverlay');
    const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const isPortrait = window.matchMedia('(orientation: portrait)').matches || window.innerHeight > window.innerWidth;
    overlay.style.display = (isMobile && isPortrait) ? 'flex' : 'none';
  }

  window.addEventListener('resize', () => {
    resizeImageMap();
    updateOverlay();
  });

  window.addEventListener('orientationchange', () => {
    setTimeout(updateOverlay, 200);
  });

  window.addEventListener('load', () => {
    const img = document.querySelector('img[usemap]');

    function initialize() {
      const areas = document.querySelectorAll('map[name="image-map"] area');

      // Store original coords exactly once
      areas.forEach(area => {
        if (!area.dataset.coords) {
          area.dataset.coords = area.getAttribute('coords');
        }
      });

      resizeImageMap();
      updateOverlay();
      setTimeout(updateOverlay, 400);
    }

    if (img.complete) {
      initialize();
    } else {
      img.addEventListener('load', initialize);
    }
  });
</script>
